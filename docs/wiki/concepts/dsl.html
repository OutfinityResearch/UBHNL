<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Wiki: DSL</title>
    <link rel="stylesheet" href="../../site.css" />
      <script src="../../site-nav.js" defer></script>
  </head>
  <body>
    <header>
      <h1>DSL (Intermediate Language)</h1>
      <p>A file language for theories and queries: deterministic, typed, with a strict vocabulary.</p>
    </header>
    <main>
      <div class="card">
        <div class="draft">DRAFT: Wiki page.</div>

        <div class="nav">
          <a href="../index.html">Wiki</a>
          <a href="../../languages.html">Docs: Languages</a>
          <a href="lexicon.html">Lexicon</a>
          <a href="../decisions/dsl-at-rule.html">Decision: @ rule</a>
          <a href="../../mdview.html?file=specs/DS/DS08-dsl.md">DS-008</a>
        </div>

        <h2>Role</h2>
        <ul>
          <li><strong>Stable textual IR</strong> for theories (long-term) and queries (<code>.sys2</code> files).</li>
          <li><strong>Power-user format</strong> (more direct than CNL), but still strict and typed.</li>
          <li><strong>Bridge</strong>: CNL can be translated into DSL for audit/debug.</li>
        </ul>

        <h2>The @ / $ / vocab rule (essential)</h2>
        <div class="table-wrap">
          <table>
            <thead><tr><th>Form</th><th>Meaning</th><th>Rule</th></tr></thead>
            <tbody>
              <tr><td><code>@name</code></td><td>the statement target (declaration / fact)</td><td>at most one <code>@</code> per line; must be the first token</td></tr>
              <tr><td><code>$name</code></td><td>working-memory reference in scope</td><td>if not in scope → error</td></tr>
              <tr><td><code>name</code></td><td>KB/vocabulary lookup</td><td>if missing → error</td></tr>
            </tbody>
          </table>
        </div>

        <h2>Main forms</h2>
        <ul>
          <li><strong>KB declaration</strong>: <code>@Alice:Alice __Atom</code> (persistent vocabulary name)</li>
          <li><strong>Working-memory name</strong>: <code>@tmp __Atom</code> (refer as <code>$tmp</code>)</li>
          <li><strong>Fact statement</strong>: <code>@f1 HasFever Alice</code></li>
          <li><strong>Logic block</strong>: <code>@rule1 ForAll Person graph p ... return $imp end</code></li>
          <li><strong>Witness query</strong>: <code>@q Exists Person graph p ... return $expr end</code></li>
        </ul>

        <h2>Intentional error examples</h2>
        <pre><code># invalid: two @ tokens on the same line
@p0 likes @p1
# fix: use $p1 (working memory) or declare @p1:p1 __Atom and use bare p1

# invalid: unknown vocabulary symbol
@f1 HasFlu Bob
# if "HasFlu" or "Bob" is not declared → load error</code></pre>

        <h2>Why “single @ per line”</h2>
        <p>
          To prevent confusion between “declare/subject” and “references”, and to keep DSL naturally “subject-first”.
          See <a href="../decisions/dsl-at-rule.html">the decision</a> for consequences.
        </p>

        <h2>Relevant specs</h2>
        <ul>
          <li><a href="../../mdview.html?file=specs/DS/DS08-dsl.md">DS-008</a> (grammar + load errors)</li>
          <li><a href="../../mdview.html?file=specs/tests/dsl-cases.md">DSL cases</a> (normative)</li>
          <li><a href="../../mdview.html?file=specs/DS/DS09-sessions-query-proof.md">DS-009</a> (holes + session API)</li>
        </ul>
      </div>
    </main>
  </body>
</html>
