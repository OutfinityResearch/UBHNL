<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Wiki: Type lowering (to bits)</title>
    <link rel="stylesheet" href="../../site.css" />
      <script src="../../site-nav.js" defer></script>
  </head>
  <body>
    <header>
      <h1>Type lowering (how types become bits)</h1>
      <p>The central rule: the kernel has only Bit; everything else is encoded as bits.</p>
    </header>
    <main>
      <div class="card">
        <div class="draft">DRAFT: Wiki page.</div>

        <div class="nav">
          <a href="../index.html">Wiki</a>
          <a href="bit.html">Bit</a>
          <a href="ubh.html">UBH</a>
          <a href="../../mdview.html?file=specs/DS/003-frontends-compile.md">DS-003</a>
        </div>

        <h2>Definition</h2>
        <p>
          <strong>Type lowering</strong> is the process that transforms high-level types (int, enum, set, relation, state) into
          <strong>bits</strong> and bit constraints, so that solving can run on finite fragments (UBH/SAT).
        </p>

        <h2>Common encodings</h2>
        <div class="table-wrap">
          <table>
            <thead><tr><th>Type</th><th>Encoding</th><th>Consequence</th></tr></thead>
            <tbody>
              <tr><td><code>Bool</code></td><td>1 bit</td><td>direct UBH</td></tr>
              <tr><td><code>BitVector[k]</code></td><td><code>k</code> bits</td><td>operations = circuits (bit-blasting)</td></tr>
              <tr><td><code>Enum[n]</code></td><td>binary (<code>⌈log2 n⌉</code>) or one-hot (<code>n</code>)</td><td>requires domain constraints</td></tr>
              <tr><td><code>Set(U)</code></td><td>bitset (<code>|U|</code> bits)</td><td>membership = select bit</td></tr>
              <tr><td><code>Rel(U,V)</code></td><td>bit matrix (<code>|U|×|V|</code>)</td><td>useful for graphs/networks</td></tr>
            </tbody>
          </table>
        </div>

        <h2>Bit-blasting (short)</h2>
        <p>
          <strong>Bit-blasting</strong> compiles BV/integer operations into XOR/AND circuits (full adders, comparators, etc.).
          The result is UBH nodes plus <a href="constraints.html">assertions</a>.
        </p>

        <h2>Edge cases: empty finite domains</h2>
        <p>
          In finite-domain logic:
        </p>
        <pre><code>forall x in ∅: P(x)  == true
exists x in ∅: P(x)  == false</code></pre>
        <p>
          These cases must be handled explicitly in compilation and tested (DS-003).
        </p>

        <h2>Relevant specs</h2>
        <ul>
          <li><a href="../../mdview.html?file=specs/DS/003-frontends-compile.md">DS-003</a> (concrete lowering rules)</li>
          <li><a href="../../mdview.html?file=specs/DS/010-fragments-goals.md">DS-010</a> (Frag_SMT_BV, Frag_TS, etc.)</li>
        </ul>
      </div>
    </main>
  </body>
</html>
